title: Übung 6
subtitle: Sampling Design mit R


## Sampling Desing mit R

![:scale 60%](images/sampling-design-folie.png)

???

R eignet sich hervorragend um ein Sampling Design umzusetzen



## Ausgangslage


```{r}
#| label: uebung-6-1

library(sf)
library(terra)
library(tmap)
tmap_mode("plot")

tww_landquart <- read_sf("_data/processed/tww_landquart.gpkg")
```


```{r}
#| label: uebung-6-2

base_plot <- tm_shape(tww_landquart, bbox = tww_landquart[tww_landquart$Name %in% c("Prafieb","Frättis", "Jerätsch"),]) + 
  tm_polygons(col = "Name") + 
  tm_layout(legend.show = FALSE)
```


layout: true


## Zufällig und gleichmässig verteilt




- Gleich viele samples (10) pro *Multi*polygon
- Samples sind zufällig verteilt

```{r}
#| label: uebung-6-3

tww_landquart$equal_samples <- 10
sample_plots1 <- st_sample(tww_landquart, size = tww_landquart$equal_samples)
```


```{r}
#| label: uebung-6-4

base_plot +
  tm_shape(sample_plots1) +
  tm_dots(shape = 3)
```





- Gleich viele samples (10) pro ~~Multi~~polygon
- Samples sind zufällig verteilt


```{r}
#| label: uebung-6-5

tww_landquart_polygon <- st_cast(tww_landquart, "POLYGON")
```



`tww_landquart` (`r nrow(tww_landquart)` Zeilen):

```{r}
#| label: uebung-6-6

knitr::kable(head(tww_landquart["Name"]))
```




`tww_landquart_polygon` (`r nrow(tww_landquart_polygon)` Zeilen):

```{r}
#| label: uebung-6-7

knitr::kable(head(tww_landquart_polygon["Name"]))
```



```{r}
#| label: uebung-6-8

tww_landquart_polygon$equal_samples <- 10
sample_plots1b <- st_sample(tww_landquart_polygon, size = tww_landquart_polygon$equal_samples)
```





```{r}
#| label: uebung-6-9

base_plot +
  tm_shape(sample_plots1) +
  tm_dots(shape = 3) +
  tm_layout(title = "10 samples pro MULTIpolygon")
```




```{r}
#| label: uebung-6-10


tww_landquart_polygon$i <- as.character(seq_len(nrow(tww_landquart_polygon)))

tm_shape(tww_landquart_polygon, bbox = tww_landquart[tww_landquart$Name %in% c("Prafieb","Frättis", "Jerätsch"),]) + 
  tm_polygons(col = "i") + 
  tm_layout(legend.show = FALSE) +
  tm_shape(sample_plots1b) +
  tm_dots(shape = 3) +
  tm_layout(title = "10 samples pro Polygon")

```



layout: true

## Zufällig und in Abhängigkeit der Flächengrösse verteilt



- Anzahl Samples ist abhängig von der Flächengrösse (1 Sample pro 4'000 m2)
- Samples sind zufällig verteilt

```{r}
#| label: uebung-6-11


tww_landquart_polygon$SHAPE_Area <- st_area(tww_landquart_polygon) # Flächengrösse muss aktualisiert werden!

tww_landquart_polygon$relative_samples <- as.integer(round(tww_landquart_polygon$SHAPE_Area/4000))
```

```{r}
#| label: uebung-6-12

knitr::kable(head(tww_landquart_polygon[,c("Name","SHAPE_Area", "relative_samples")]))
```


```{r}
#| label: uebung-6-13

sample_plots2 <- st_sample(tww_landquart_polygon, size = tww_landquart_polygon$relative_samples)
```



```{r}
#| label: uebung-6-14

base_plot +
  tm_shape(sample_plots2) +
  tm_dots(shape = 3)
```


layout: false

## Gleichmässig verteilt

- Regelmässige Verteilung der Samples (auf einem "Raster")
- Implizit abhängig von der Flächengrösse (grosse Polygone erhalten mehr Samples)

```{r}
#| label: uebung-6-15

sample_plots3 <- st_sample(tww_landquart, size = 200, type = "regular")
```

```{r}
#| label: uebung-6-16

base_plot +
  tm_shape(sample_plots3) +
  tm_dots(shape = 3)
```



## Übung (Open End, ohne Musterlösung)

- Wähle einen kleineren Kanton oder eine Gemeinde aus
- Selektiere die TWW Standorte dieser Gemeinde / dieses Kantons
- Wähle ein sinnvolles Sampling Design und setze es mit R um
- Extrahiere die Höhenwerte für jeden Sample
- Visualisere in einer Karte:
  - die TWW Flächen
  - Gemeinde- / Kantonsgrenze
  - Sampling Standorte
  - Swissimage Hintergrund Karte
  - Nordpfeil, Scalebar



